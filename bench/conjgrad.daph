// implement a conjugate gradient method
// based on the proposed algorithm in wikipedia
// https://en.wikipedia.org/wiki/Conjugate_gradient_method


A = rand($n, $n, 0.0, 1.0, 1, -1);
b = rand($n, 1, 0.0, 1.0, 1, -1);
x = fill(0.0, $n, 1);

r = b - (A @ x);
p = r;
rsold = t(r) @ r;

for(i in 0:$i) {
	Ap = A @ p;
	alpha = rsold / (t(p) @ Ap);
	x = x + (alpha * p);
	r = r - (alpha * Ap);
	rsnew = t(r) @ r;

	p = r + ((rsnew / rsold) * p);
	rsold = rsnew;
}

print(x);
